services:
- docker
env:
  global:
  - secure: hA125ahSyKjzPYKoINN7tSbuX31yuggaY13SrOAQV7dybHtZmogZr5QSvBnCtm9gCm3s2BRCpuM5yGHrpK6o+I64GQqOPDGQqCWGXQD1F/HAvDIXjBuMeFY/++8fbhDkkg5u7pyTyVug68N+EAZtnkAi9eCABkj5JD7rkIksUaLFRMt7jVV+oIpKz767gWBs5Uu8dXOI8Q7ts7irkWbHpcV/8mkbpyjC3X7+8GqC2yo6PUyV0quIRE9IXrMA2MsoCG+H7wDOxcFL7JVuwdEKOlKAcn2znhkA+9m7zHln830vyifyXb2Wy1xHg09yJv2SumashzG2PTzc7o8MP+P8eYYJiH8lnXUPVZ5hT0/HSPSfaBQm1AX+CYyWtqCxa/DeO3A42XNOMxsVaYc1rAxuNIokuaNCqAwFnVy6qF1LORsjCbi4JUQ4z6+c8v8CUIIngf+yhLHQY9d6UaifSx2UZ9R5Ku3fGE4oy7ICkmcZsgxwqxMW8hlCoBQVyfC+a9onYLEEOaNePe3eZAX4VfE78lrtjOhuE0Cvba6LXPK3T9t0aR7BQ1dtYintxumBX/A9ci9TV1of+ddWiNNO/HLJFgIUh5BkuMq54lUvOagOYFJYMh8g64xoxHsKcpKJyyZ9Zjqd+sgsBtOpWf5QqqN828/jOrxIVuA0Zcxm2Qzxnis=
  - secure: eNCSwpGPAF1IqUuDXqHUHln55ipgRcft/Plq90WhaOHdtPhCc/Ry4YGKBPJaBufRP+RhoZstj4H5IE9lMprpq5AWM/9QLmSDSjeGzNdrJ13r8G/M2jpj0aVSk+z3hLJPH8V8y+eZe7ULLKtGBeecx9Y+daMrRTLC2bZDpB+mvGG6MY+F7a7C7sSwdN07jeOHIaXVDgWUTtDXhbD8LrpyL/mF8ZugRrzHgYY/3C9rbSsVc/jTmEIttTdc8fZAUAWI/rVa+1zGYg6VtX+q5E+mynJyy2eMon54Co/IK9kSYgT2euMEqEFTSd9LytEFfGAA8YBxQ2kZwvYqfWx+GuIvDIqyxt/E3vUOTIOwst5SjwDHvaKAxJk0/vtPnszDAP1uFALkmpdhrskRI06mIdjedo4AP0B2iRoXTQzda5zzyutDl9t4N5bbhQBaPSX59Uh0kI/KwZX/v4Ivs+yl+2VCaQi6HakbSgYjDVv53QRf9kaP4GbdpIM5raad+QDm/XBBdGuiVCDUKBa+uxEJYNWGH8V0g/0xOys7OsqRkMYbxIHjWukhpPDYHGVR4EBIKG5fGWAJbu2z9DLl3B8sGUKjcR4UDoZxlceJFZ3OI7rIc4G6AvL6CJv4e2plwctgcF1pJfBsjcqQvm+tdg14gnS3wV/xITrZpMnSmZa19C9bolo=
  - secure: jko6myv0GW8adhHMl5qm5qSf8TVbEEO4t/2MA5XuDdXjwOmlJi8PMftZc7Pc30kwQJmEGXgsgTjeqhN0bnnwDAjxTC22S+1sDU8DGF8lAQb/J74ygGoyrHBhxBNAPzeu2Nww/3Nm2lf0xkc6/Q+DQimSM0F0G3MmmghTUee0WdSO35rrPCpxLzWjbUDdAUkWF79nHBxD+KZRfhwDPncwvBa6tXr2DSY8PvTl9Y/uQ1U6ZoBr5l26Zbjvzv10YjTD4f80mUY4mSd2U3+eNwXOS5asbc4Os2i0PhQPn3F9YdDBo7YNlfn6WQH1VqSIn9Sg7NuEapRIQz+tMCFuUd45CjpyVeFY/ju7RpNUq7JwwMFJpTwSyM8mKhCTmv68WMjdocLJqNLbZCpaftELACafXBFVDWGVSrLaLshiOXAkqtE8Wc4A2+dIxmhvrCX6RkOA6EV93SGQZixygtrcsu7FGNZWo9iyn4LrWXoLuJDecpsfzKmxgSxTXDNoX0/ujWArXfV+T6QjQqQlFHHgy1eLHAyk8jgd35LIzxOmMqXvHXCHKVltM15K2EM2olye+ABWkeuzpSuJX/+TPV3yRVSncvVO737gHB/YRDsUp8SVmaIEOzIH/BTPY0jHaEMH91vchnc0Sd05sQBMsFYO0fd5Fwq51QOU97CJabmnhVwa8X8=
  - secure: HrW2S8d9xWRbG0soo+rsSZeJdzAZJD9fCAdgwjFIEMsN0y4GaTZflm1agTx98YDYeFVBN25FU4GFVnx0g1Xqr20R9eOSYCw6qoIzFk7TMqqj451tFRfSCvemXEKlIqNCitzgQvV98p2zF22341WStC2q93OrCIzNUuqivZpK78U+5MWPyeTil6eo3lDDcX83ONqlyf02+vQRPyiO0LZj2kZAYeP4UQVKAbAK80n4QPBK4OJMA2OPUX1mHLv4q1rfM3QDFubZU1p2AZ0Qwq/dhOCVblt2lX5tmoDwUim+6ZEs4Enpd+LzQdRBGP79boBqldCrvnzAdjIzM5dxsPAJcDL//3DPWf3HVtjM3xBo5MXlYoemhRdGcmcTpYoP+s4ldndao6+KNYWwrDp3tqyPHhVJ3GpEvmgLA8fahiSl1pOwMl6/gLsdEpeuS7EhgZWn3TfYtvWnNwG+JhBafc/k9hwo/hqOjJkQ9Dlq4kW4AvPOCA2IDCAG3tsjdyUzVLm998IkvhEJ0GdN3rOhrlvXdZ9xplb3v8d9LSuD9SUzFoPBgv1qkGyWKT4nxi6rOJLkUc1XJCtDlRPE8+UgmlmKDT539+5V3zU7KHIrngdr69CHzus6ggi119pwaCpuoTkS0UmDQOGrj8R4L2FPzKFhdFyiza8L8qe9Kc/E2G4FLM0=
  - secure: d94XXqgCY6emvxT2yJhX+ee9ART5vjo5wZrPf+N9+jEuIGBFg83E4xd5FFfQiL/EUPgkEOubloW0itTySqQ+lJpZwYFXCaiVaQ0AjKzvxKlyUvgfkG462dsyi+63DeTLrgzlPYbM2V2zF0G9HoUwHz0zpH3HeoWR1Mfu3Dq5hVCUajPv8p5Bd9G3PlxiZ8p3FHWeGXteJnPeLvg9xC4KKZtOc16DB6etF2juvf/cOHr3EU43jWWuSd8vXK1GS5RtpHs4mNtbNDloXNzqPlc1XU9zeuFBnUTONnlSOwqDCzZQtyChqJ6GKxj++fIosjZcslCW3g5WQnIQydyodRvNLQ+Vk+XTt2UzZcDS2HUBH/410efzjQXSOCZx5gEqjTVYmw2BW/ygfOK61gL7gatawJogU5MexO2dyjr8iAmbPMS9UjT35EUixNdqXGCoKWUi+EKu9tdQukXZ8Rmwmxaa8PaZFoSfiU+BIOh5s+dn+Y83ZUFiAY9H70XhcmNvPwnU8KK2SOJYUgsW6OM/6Ur38vnhg6UiIJDuYZcdAiG22asQB2B0OXxFxYsvgSWjC4YOU+vblyWd83O6wPe3bO0BZ5n5pQNk77HMvTryKWsplK8cz8c6NYg23an9QmEYERuO6q552URVAp+jxDVh2cjNmDxQ86W148FJ4lWLFL5Mfu8=
  - secure: DDHn2KHqViKpnpwZhhK+RM/zDpyJRdfssyIk5FSnpHmNRuBa2KSKy4N9GCMYh4FmjXKrGJGW6nuogL6lUviN8Ru1eg4H/6brLPr6b5LjwoBM2tB++x62fIVLyqiywbuqkiwGemmPrM4uxFVhHEK0O99t98K4NqI45GfzxPwhcNdG/lXdVVCpZP6dDZtGSUq91FT7c7zZRk5J9BtyBroRFI/jDzC4mPpUsxFoqQfRCdzPxPpBC5rmXn8Xg583ALRZEl8QpBxEGx3UpfKD7EHhRecJF6ncWwfpTVQRlk7JFNMn6qJg935EkBnpCR67mfyfyLMoi017k5V/qEiax+ruNm/zG3Sr2n/J6MqMOyNKxWKWwbdk6uAsHxfcZlW/hqZ2Y/96xdL+Z4mcj8Dr4V8Gbq5jjQ5C3dLBtOZFmKBK66p3JfYUds+fwoSSJxeV8eaz5+wOLgwCtg62LWOmgjabNdtiGT5pc9iECwLt2y3+GtK6XIxq751Xa7uuDIw1tf3SnKMsC1zIeGoJmqtgkSdkq9gxduhgvzwiMuCobKSYPYeoC19x1eL/9T/DLNPCr2vnHVUXZgM0owGfnrb+0a831srAATziKTjnQINdE1FFq/NqED5OAfJdZnFzlXT7ux4qqBxjxG90aLZCrz8CGOV1ZcyF6peXI+fg/KMRWpvxmyM=
  - secure: uwa+em+aIDWz0TJTr+lFbxvCKIxSCrSGJl8pkYdBEztUkxx/+xwhnhYODlJvpE8sAtuZ3QwKUBXWuC1Bw5GgroaiSFX+c5Qax/3iW/CnZDn5z1+6l3PhMrUZ3icDbLpLgUU8TDk9ihsZ4Rs4Ow1XwA0KJfEQlS7MLGAMpXuuwaSmq68BBp6pP7AcYUhQcv0mynOOBWjQ+8sd2g+6ubIs55zN2I25uR2oDU7BRNzVapjm/m+D7oJ/2uNzXXYThRtWw8XJiqGtLxD5EG6g6omV7KNezXuU284Hmj3E/CQYYs1S+TzS4b1rcRuM40UmeOaMmtMgxUIWArx14hRXBlyWYpSNTmgE+5F8sGk74XzDei7N8yM3oo/0yI1cnUpjYsTF1g2i/UdpUTqurVUMdif/RUpo6j+ntzEdAYP3ZmdADh8SkbJwPHEik6eZLNYqcs88/y1GJszvpw3jIvXchHXGhARFFx0iNiBzqBD02/mlJ6RDqa9Vb7ZfccOdHCeP+idNCAJKXk3otBSnoM9ZaTPXZCVeOFJHQKKFZ5gZxoBWzlw4HaP2VK+1eU7lR5+LIUrVUoO+nKkHjWdAETsQ8pd8hSdO1l/APB9tbhIG1pL48t6kLtEgp/8zSX/rS96HH2Mw0jtP7/YqIlc3UYsw70YU/CTqZQm4nwKAW2rg1rwSgkk=
script:
- docker build --target test --tag todo-app:test .
- docker run todo-app:test tests
- docker run --env MONGO_USERNAME --env MONGO_PASSWORD --env MONGO_URL --env MONGO_DATABASE --env MONGO_PROTOCOL
  todo-app:test tests_e2e
before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/todo-app:latest .
- docker push $DOCKER_USERNAME/todo-app:latest
- docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com
- docker tag $DOCKER_USERNAME/todo-app:latest registry.heroku.com/ganker-todo-app/web
- docker push registry.heroku.com/ganker-todo-app/web
deploy:
  provider: script
  script: heroku container:release web --app ganker-todo-app
  on:
    branch: "$TRAVIS_BRANCH"
