services:
- docker
env:
  global:
  - secure: wIoZgAuj3XDeUYm2NLFJpSFwJmSCX++AxQLdqzEv1Psij8g1da1KJYn9Jq1MYa6OOdGnHCLlc2+/SvVcH9/gHayUQJZPzECkoiu1+H/dxY1od2wnWaeKqzLSZAggP49DWTPy+uMH5+5geID1H67tSMuRPkpxy80OYkdiDSyv2LIlrAJTXiRw0iwC7sx67gUoZofIFf6cZ6S4x7HJbSDWN/dZKWTBM4acXqp1XeU0VeyC5otXGtchPk+UhW59chspTOez2t3uUK7UZWxou/83rMsayZ23yZAcQ6+dyCOrxVQwcY2jwx4swzUbqkRJ13kZlGqt9ibSSx0tgTtaCOMkqAGxM+snq83FTCY6GQNkUJrSp643k2sl/x2fU3UmnoNovcvQLV5Xob+B15QS0wThPln8Cxz6M0iiRm2bb+rjd4Bv79oumZDlzoaG7kK3e30DxwKVU1ikOOtJsxPE2aM7NDGG+XoEPvQFEVBrq6bB3q3MLs4Bhoq/uKUGlyhJzJgzep13qM9/UTKcGdmXmKnbRjp+LpUbliz0GCoRKXfx6jpuPiZEYuExY6RIzuHOSpHsROUTNLhoCkJANPs3xNU8mKO3Yf3a5LnWtvOANXBOtc6bMqdfo08bizwNVn13fphNhyCxgw7jtqySkWUuw84xPEf6QVieCm+BeZS98UxoshM=
  - secure: SMxllV1JwXt+EKnXaxh3/oV845CZIrS3j28VSV/t7EZOIueAN6j9ICEuyTBTWqlkVAd5FueTYyL7kS+NgxDHraYvYDq+rxQE0wuc+zwd3NU0fszC0uD61SiXltYoGzNsmK++oqDKsXddYaqFyJ3osZQ/R1bxdzph4hn7AKonO7DGxXykl/xJf8XJ+KmwuFdRzFckkqdZxLUAfV3hm3uhJG+X/A4XMECkA7UpwFEUvspF/AsxXbozR0iZwApBXzKmChZwNU/HBoWxy3Cw/MrLfVwk83lnMhFpDjh4874IpFt6E/6NWil9l5cxJuea454OMQ/HuPbxr/ykTBsol+MelXuuYMjWOpV1H6ce1bScF+wh5atVmA08ZDfnpDeFzd+wXQTtKsLU+Y48nTxsfAtOKUifOjvqRmVZaLVXUO1MDHM9KDC2lOSG3Pj/cnh78c5lCcx78rNJTdyzyZ6gbGQ7AlQIIWhYj7svtEo7/BwQmEwTBC68xsG0FmBzO8igp6cgPlViouw5BPXxpaEcIHaQu5YrD9gBb4CXZs50RWYkwtK53HcoOEZHR+4/dY07QHkpDcr0fXL3h8OvF77KmgHdsJS10Sp4ccfrD22vnJRyyWjDzmjphkOfbQg6iro2Zp08YUQWokzw2esak4iFSArNX8WvQVycCJwHyv3JtGPXqfU=
  - secure: f/5CuVYNzwHCGA8ZnYm2tHVMmxU1Cm3u0CaD1ukJwPi1T/btpZ+Pc2muYDIinZVDpdakeRe737TIjGuvQ90WE2zkGyB6jHTWe7G+9ckcBHcCEl9BK40ytHrJlNmAI6qi5ZNBIFPnnTYgnlg/PC6oublP4+K36xGsfSdXG4BMGn+fBse22xSeIKfXQExrZg/rNwJkwV6PuzQvCADrBfJ0tXgHXpu+N2qwCU7PP5VQvOWxlrqptBBXHqCjYriJz2OtacgmJidqTF0nTaBQteMZG/knaYzlN+b9VL+z1kwu9UzdOEuNHMWkuHHQtUzyoaovGNTkT+Cqv/vnGg2rjYqBoM14tpTPhd9WMM8Gy5hfgTt2evcc1CcPpqnm28gUvdKu+1GcibFhYGIeBzOCBCjt2FaW/5fEIYF8eFkZBYJeHiGKGISel7O5T1x5NmTWoixx7boXWdVG2r0AdfHcm2djmChn9NLyAeR5+2AJgaUizkW28j8PGzOtUIBfs+dl0OIwuY1qGBXkSoDIRi+aoe02NCPOnE59K7fR1ETpXvCw1Ff/AslT/hwRLqCF5ik4uvPdTWkpqvaac+Gay9KUorD/rmjUSJuyxxnJYY3pIxzyDLuz9rLMwHJwHT2fa45i5fLINzwutHRvobDqXpb5xRgceIW2Mxut0q9xGXpKO/9eCgc=
  - secure: YnareXxtYKiEXBTgdZOFaHXqBuTrWkwJ5LhNkX9gZl4Q50wLWPO27dfxpaZZzez1KZWpI1WY3vJRXAwwWax5A0xtNWPNbHQZFCSC4pzNDq1+Z/7Zvj99SQ0vga5gMWPMsedWgg/YihaPV9VEmutMT4pCw5KP9tncpArl67EWxZcpXAICBYaPs9sykkm4dVUNVlhhCyIm2klMQAujPeeXvg0czyo9qnFumpgGfNcgTZrfPXPfASmE0LAF87IVgWLx7phYeLjfdjDuybNyppZ9fw6DEZnEuRmQd6G3RM9ofTibvk0AzXs0E4ubYM5TInstiFb4uNINt2Tf3GDa9W07T8E4BTV0GnxNlme10E5h/Xo0TtgyuFKhyUjFRWCoMou/FCFhW9oZQP7WkIDPYmSENrcBYGVHusKI4NVA3EGjdWUv528q3w58Jg9936+Mc9pCnUtCz7bRiSnSqj0eiZ9fGRpvjsiVNbhezz8BjnN58JbTPkv4xepg0RJMKjg9eIWW/iDsF/9sNr+4ftdLYrQ5LOeEtvnRWXq1x0Zbb0pF5r1KJdvu5z+KEfDIlZz756cO1bsW/MnJIg9OlZuR/Hkzu7I315om8g6UbLFLH3L5X6yiNsL83wzheWwIpZR/8IjVCo3oyi/0KeQXPEldCcGTcys55u4d/rmSDpCdqoLaPCw=
  - secure: l5VZQZk20vHYknN5zxtE3mLub4SUCPMJ2rZTpqM3BHrgGWdEOQd1o45AHv1wPQURqQNvpTYvOTWe6R6XHEGXwTkOkYrgAL0s3G3XJhB5yf43Qnn1wq9I17a8Mp/Qz26IAQ+pes1wszWzUnUrT/SxSnlNkLjDAADCt/zyflQxi88j3fvd3Wa+3onr4mNaIskSG1KRiPpJa43EA/SeRMG1nZxYV33qD8ekkEi+eb/w74xUI9YsP/AF4I/JexSTxJSPOIFdX06TXy0PetYnpWn2F1rZrvrY0edfcsfdD/CzEimkVqMmDP2p2gWZY96CPTlT/Suqm0ZIEBgQcCZhmmpwG3NiYo4oyLKIkVOvyQT+gABDC4LKy7eJMkqkAHX2gq2OtWpuPxCxqalOlCfHdnx2QBnoOB9w092IJX0ujlbGjjV71e0WalqI+aN81hrVZgJ1fS+u6zuNx90o7HY8iLkDFd8wQkPsku4hCH85NazBgBl1KI5cKBkIoyL9cpUxxmEeEtqgBrQ5fe8FbK5N0p7uwwrCXFPCZAoB0ej3uGkSKr+kgzP0TxKpRo5eTHgyMT1UwUeFRr2D1Pcuc/sQckaGJ5xPa0O3+E8SdrcjyQCRkxAlpCu+l0pvj9HHwHuWmie9rRQOplRR1Cfxg4vbfr6iQpPbGE/J7GKYBj33ryHG3O4=
  - secure: N+P4cZ/n7i37LetzJ1byXmW4RaiwhRvZ2JAMUY/sSVHCBXYMlyni2fXBdAWxBf33H/+stgt63cfKBUSuBthJBT1Zibgtpk7+11lrKsHDMURv3RB7Z/G7Q1UvGQ4KH9GkFEHL7R+DTguOIddP53HNpSVb4VwQ/6Hz1ePqGPho8vHS7tLBAjxFSKymSeyFnnh6H4A1pHVRXQJ4acAQIMTdE0x9kTLXltWVMdlVWg4QO+ZI1U86hzB7L7CcaRzS6II/56ZtU00LRaiRTxZvIr3xmdCM9RTW9bwKKEigXCZVBnFaUm9UDYlHNwKNgtIB8Rp6QH/QljiOc6FNehnxHaPGBhHzXLL0vaSGQ9GS/qRpKCZ4R/g6VHkZiyXfFVS0+pqn1saVlQ9X1qtj6+LM9GR2bimuvc9sKkzKO3hP6LNySO+us7i1RWc3P5oqjnzsiHNErhB6QUghIQs4nsMuSbEKbyhZkdMEPxSbDU6kU4t3Y/W4o1zqSOmEPvYRmLEet8TZwWGbmGIaM+pcWJ8fxlwiz8Xcwvq5Dj0AzT3iyqd3obwwH8MP04WTv72ntw8x91kmkrtSakq2EYxRiAw19B4W59A3FUAGhjnm5+8TOspZHbchrtF+aVcKq/FXBxEXR24QkaK4gH1pc7jvM5T+pp2QfC5hWdHV03uxda8V/SD3fyk=
  - secure: UaHH2XBm9Q5wDpP5ioAauwV811WQOK5rB1MEPoaq8ruMLbZ1ZQ2AZZ9eWCy7N9stdRb2N69Bw/Z50Pvw8n4SlAIxvVdyqZGjofwy3hesOJ+7yGz+njZNX+V8EN2LntQcm03yLkLfBYxLahn16afTme18Z6NIUZNcm851bB0w80jcyumroMHJxdeI90ynJ7cy+iNEw3Ld1VPL7WWtaZrDvOP1HZsGmGva7wXCk0KZblcogRnZzGXDtJE0WeTJpiajlem3ETO5YU9WQCYHJwp6Pr0PQydQDD74XTtzTl/6c1DcqdLJ9kTWnzKTr3BUDDLzLpbFOBNJoodGmuK2zPyKtlYkXK5xkcpvUW7kE/ctn/ZU9Us7S5rfT5jgx2R1Iuu/wW79jNMjsXq01XW6Xqgm37LEhmlmdZz+6DVvI6gB/2Xp85JP4hMaBIGWq1uhWbFBUgh/wAaRnciWKeMJ++OmVwX6slE7q/EvGchnXuD3ukHVsMKS6xjmgA4JFbEHHjuHks+dOdQ39jTq48hXq9WOHwMIfYdGajhTKP77Ei5p7zMegIikhOMa8OdshHFMd5wf2uEN6k8QkkDFzMym4iPEqm08L1dwBRdS5lb1yrNcg51qxnvOW13QYVY5+E59lIutSYLdXoxjILlQGgvZZ3/VorzcHkLbEuIYamA7xDe1njg=
  - secure: CrHGtTYAsINwfSWccXh7OpwUR1r9A2+WdTtzI4tBzl5818SGWZ4nsOSL/T6AtZ7BrE86x3jhKN1Gedv2yTPeB60kv/BdENnXggv03bYhnOmeAvdN5a92tJrVlcHV/fR6o6fnua4tpEz4myr9dGK/eSkCElNETsBLTauOMRTTEUN3QjSNRJCdxCq99DQtcYFIaDxajDgI1M3S0H+Grd0xmdwChlYqPxzhkX8e0T3E/U+DFYUmWFyPx5j97ihb5uLQSyUP4wI4Lma9xI2BIQVsb9BgXuUb6UOdrSCVlX8quuSDAhhbpO09zoDPADmJyvGzrIig2FNkPZJzahoRSfTa1Damm6+qiG7H8EzxwDZH/RSQNfDYRr/RN3R7tLjMyaO0OqdZlnVGkf11dcOmKXCo1ubn5mTvhAXySVhQGsIX2SzlrBRqKiQt75fRnCUNEZdB/38kr4wHRL5L+bXAvKDe/dn4G1V6yF22zRozVZMroASXJTtsZtyVITaak2e+k2t4a4ONz2l32nph2K1nQ7QaQH2+LJLHbfDofnj9hyTCqQAVPluCBWEOxiDW7Ix58W0GEImBcztwDgvmu8sqvXZYkU7efkHgphRa5vMLUKMLwAw4Q/BHiS07WjiO079hWuoMUjHrudnLm1MIYbCyN2BaC6pxO6PqRO7obMoDIakK14I=
  - secure: J11tH1SlSCfV82jxwggu2Gf6+85jsG0kxPQIWkxIsODMRJFMNIjVLAq5IDu7MeqUQtJxJW7jzb6tPBc61ksQEXxMJdXYC5xpzXa1SnZ1+z85QBgub/iAtzDxNKFIZIwd5QPWZVKsvLOdrIfAj09ZKWfZewug74iPTd1IzKk4/oMRxDGfjHSTC7Q4zPUcibCYHefhJEl8xFdmmCFJxkE0tV4oYqpuyHTimfK94ACa96EEYe+w1VDAoji+V4XLypH2YqTKroT20cX69TTzQtmAjZp8+AjtMlbPGuMVXMf9xTyQoh1uogq9zYAsydGEAv4+Cy7vae9MgWEMBWNr70nUXaNh1delhouzIfbBRAKjJvbBF9XjdwP8ZKzJLBVZXpiN0YKQagPSwaAoQK2lUUvk1AkQpGfKwPh+QycwJ+PYrnBkAxNJvemPWNaRSvXyfmFJxDfFUjbBDuOFkLOC0o64GlPliIEe11bUdchL0YICZCpH7Q+IDo8qeiDl+buFxDRE+6kTUBXww1H+8VNod0fmndpPQSmWizQJrw+LfTBACUncxy+4KPK5Vw70TXTYDYosvFrsbFt3tXhDb6KKZmt5xDHCi0KSPGfdlwbclVLqvhaqN+5kwHSowqMpDh0zvt046e5dso49Ub7tOr6/p+9GV53/YxWZTBRUTDYeprVJ5OU=
  - secure: MFKhv89NFXqdORi08jOzgBVBoHJLVCVMU16A8+OG+QBm34judmesae+R/KPo60eFLeO337mVRq7T1pziL8C1V2AxI5Wdvn3uthFDr92b4wX6xh7gB5A0kGjt/7G1MxZ99peIVWrKqBeHTvlchu3vCTqxB7BjmaunZkFawUdS05Mc67rKXg6GmvMQ2/hRAw8DxN8RhcimJ8A9YtYwTAUuctgVZuSKjxS26jYX5uCl9JhnNwwrsCD0vdA4zZu3Or+NZJNoZDNCsPoaVTO+T9z143b6UXJY86zfLbJtwJau0Gvci04Y4XZ+jVcZn2eTEKGLba9Jb4s4Td3B1RfEPx6hS4URjFT79gqJj3OpNfbH3jBVAVBHiaJzPWUPjhOFzzF8QP8VB09Uu2/PGGsY8LWO903p3/Qt1F/ZEI7dk9KkoVbptkaDniF0UmtSypHg23P0e9ZE7yjGXIAhFSSVDvsQEtueh8T+YznlCukstmnMHHMp43NCH2m2Ck72NpIFC4tUD8Iy806J9Ls5aLR0zcrDZWapIamqDwMHETuoByAJ6jWS8UHUDcMtNkdwt71Xub+Gazp9aKR9JijrhqgavSNe9NsS/95rKjIUhMIRQGKNrMEM9com2bx/b0iZCKY8J6mfbBsHrEPfdTRqLXiremoNqC9pRn3J4N+mBpNmDM6Qq6Y=
script:
- docker build --target test --tag todo-app:test .
- docker run --env MONGO_USERNAME --env MONGO_PASSWORD --env MONGO_URL --env MONGO_DATABASE todo-app:test tests
- docker run --env MONGO_USERNAME --env MONGO_PASSWORD --env MONGO_URL --env MONGO_DATABASE todo-app:test tests_e2e
before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/todo-app:latest .
- docker push $DOCKER_USERNAME/todo-app:latest
- docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com
- docker tag $DOCKER_USERNAME/todo-app:latest registry.heroku.com/ganker-todo-app/web
- docker push registry.heroku.com/ganker-todo-app/web
deploy:
  provider: script
  script: heroku container:release web --app ganker-todo-app
  on:
    branch: "$TRAVIS_BRANCH"
