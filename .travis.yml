services:
- docker
env:
  global:
  - TF_VERSION=0.14.7
  - secure: pntcomaS0dG9kkFcQN50wwITDpWL6JJkhF+qnH0WY/9hSvP0KHMCSbA2ZKnNdDEtofYSkhBurF05XcfX6/HhmyykEDaFrdrqFeJt9ayyQH/ZAU0CxT1tg1Xp+AJMabOBpfBbi+6JF2dFz9qw/tZ6W3Lv9yMibFVdFQDphszk1Lr9fjAWd4d+LskGdGfPG1pe+sdygsbnIuk91u5d86OveMHVF7I6/Q0fnQYg25dQE6PIJeetOzBVhHZfQKEY8xnKhs7t8Y2aDkmffUQ41D2CofrxevSbegeuDfNMtFUlifUKoIKG+z9g25dOvmlcv10pf22iQoQdIby5q+C1+ySBFo9ObKnu7I3Yee6UIe5QYyvCrC1s0/bx19Sx3xubCUAw4N8ehbU1pu23ZvZfcUlnjnnld0i8HnXw4oqDAmgWIOh8C9r18TXiGmbSqOJdJ3g8BYBAavDceBz1RgLl83C43fsoHgjp8VMN/GHAKuHzZYIVYQST1xTogheF39k7/vo/GW51kTkBk7GILy9i1PRYdYR1KnRwUqPECqjkugc+7GzKQ1LLgnvpKJ+gLQnlP/lulsIySxpn6ojCaOYNz7MH/p5RgZWzlSTyN61CtL5w3Xax5FIZ4V0BOgqFBxkN7wtFNJKASweWvys7jeEu+UpEBZYsvygpYGMVArVvfcNt1Lo=
  - secure: VjvD1463xClUc7H5St9ZMWrWMawo2KqE8WlO+Q6L4cqQj9YFU4/1a3z+S5tIO6wu7Ru1HJF679vfN8ktX2hi6+6s3aMxtI50RqsM02SU1/MeVXXpP8Q1M0wJCoeZdNCYcG2cHGF78BknNQTfElXduw8fpXlHwuPV5VPt/P4tX0QALKLJisu83ZbukxxYv+SV/2xft2XWM/Kbsp7VkDywM7ELsLOrUz1CtNny9tEKPLBSxsF/660utCYWPTZwq3hq3WcwKgDApk8ZDM0mxFCSI8ZLrnp6O13fFV2/9Nt1Ry3TnEoXwDgFL6rNLgpvYNQxvoW5ZoU3GUcx+eye9ueqwjxuZchuOIbINNv5aZeygRWsff8CiBlIAGAjXkwwrCXMDUMXgYJCoc/lcWaO/FI8N5gdHVmkJAcTKv8O87PQeA6Gm2Q4pg2+9FHkF0QLX9ETf5TB0PTSKmSdDk6ZQ3cVlmqGPwphL+xiuM3asfuUSRayxZtULx60FZlIr80Zs5GCfTNrf/O7Qq/cIeKlqimA4Is+6UuxHQ4KLixjLj0GWJkLZIeonL2cI14zG/6ZuW+PkZdF93rHVXLnGekAs6SthP0l8kBewlmtszQgsgDFRyMeZGaDzo6gK6JB3A7H1paH2/+PNhsa+MvS9c9fyJ67QqaGjfyCRKQNEBuwuH28fKE=
  - secure: hzs+CSsmsdx4RSdl8eX8fLY4+GvfByLMVdXLLFyU5WQRvG0+WDi4sK88QhNcwLVDB2asXzv5wYfzoimgFyK+oFLroIThHuhrJmlst+vmYz/UrLOoIAzkqg232CWFoDD+JEe125LA/FGZ9tlJoPXCRa0c4rDiUYn8CzJHwV83tEM6uoUMhTDlkJ8LEpQKZHYTCZr4uYc8v9Ce/pp+d/IvlQVp2BENMRibFW/z5d3uywevXD6p2VQkQl9MaS9zbvANHFLwuNL6jhprCIxAXUIeclARCSvpQej6P/9jJiBcIzOsMU05iZAAt/mxF3JDpXr1JdNJchBDm3D+MC88IMxc2iUFpiKK9yuOGCj0BM7Y9G6wk9BBjTILGo2qHcg8vmwtpNfXjufVXDGSfelGOmAFK4aGX0tSR1E3ZG/Rhb8+Er5Nkk0cUTAFpL9txRX5kK3QVS+fBqjgULNFORb6GAG6q6V6uqouCKIgBQCxHrRUWM5uOHZTZVap59PV9pUitMR4Xl54oOMPn/S3JRDmum7Gp/BGOJslaqHU533dZlyVV6kDscNriL0DE960gRNGw5fmW4Uokb14Qgnp2dXUIty5AVrvEe8slbrZmC4smFH3bwtBdyxInjQhJROMK5cDqD5urrebxJz430K5srR/BcmHhFzCnyap1R/0+nZEy0QvWQ8=
  - secure: NZovmG+QjmZfkfUGD7BFeznX3Rh99EmVcCJvEcwYM4/jeEOx1SdtU2UvPmVSJGD6zCCaDnl5KK8YSq5v9xYNN70wYIdfwosvBe94fb0TiAfW05BFq764eG3ktCctjmc/OoKj4SdBhHrcu+wT6e6ROQ2855wCHUbGzPEGTMBT1YpC2/DpXkLGnQqVIbWgAEwcZUnxhivqfAR9wrWFngs7gzKzEFcCnbIVgp4Q/BbDSXx6ml3UgqWYuazGZzcZ3iWVb5MlOzrjmr/IHWcbmduOTFfypTsVng58ifoT2rjpSdiUSswi5nhvEYOhNNmtccByxDryBPuFmaHix70I4qq5TWwnVeYi1XpS87oGVLE4ae9kAQN6nA7Qf6Pl4pRLxIhWTfdhUcF9v/dnZArtGwT/wWn5a7h7KpA09S0O5KKUPO0tUEFSeWmrJHY5d4/t8/BaYL5Vlf+4cg+DuI0QlyRUseamAsZBn34w2W+/si7/Q6+aFjp64Pk391LfwaOqRkdoxhv/AhJaJNlSSCqZ96zpn3yf2Q8MuPlpIzdu88JDhpQ7Fsa+/N7WTGMxaYmdqTUPjW+wdaytKPc5M4b5RnNymM2y5K3i4PeVW+mY6BJBmL0J7BPn3+lnHEO66A1DE23tmiLbDGZ4l6K0ek206ZO2P1cUQcgnLUfKDP6WP6u2FpY=
  - secure: DfBmARN/ZL4A37ASRPsb2Z56dme/hYQ1ieNFhVwKe3IUNnvI0QiEi1APuEQjCwAu3N+bThvhG0xpV7bauNNHuPlCAB8lURenKepDpmDHNi2e/KO5jvSqBODFA5lEEQOfQeU8wGLgW+O98AnMg79dPxDc34lpEFy8l8IYfjtDto+hido/5Pt272Addq+ykl2kqalPtRpnWZq+yYqjKJLCo8miWjzfEDjWVbxUnydMoLZ5d8nkyB/XOh50/bEMTbZHi+E0YjCPAA1sj4hJHsSNrgWee0stY1JifLEHLhYdBXdsqMn22L6LLRM0T4xaFVBp2mzEXVFxro/wfvKDJEBt26SmWQiJ6HwNDy/+8eSndvz5EjexED+v0hSUBkujRSd7Jq7bD4UAdbuZKDxe/ncqhmAs/ArAbMWlCeq9P7+FrOHhEv4tqTsUxePvHdR9gKTERh0hhg3chBzO+MLc0CMJr1C2RZX3RHlWRxl2ov88RfL/gpJ7/pL2fzge+RheWqKFtCFeNyizeYVz/u8odGI2xKx/+RH/Q9yQwQVdV+Kq46vggp+K16w0ogGJwIdogGehPLfWmSsMpZPTmNaJJUE28BNytzg/vlYiCtHwc+j/tQeci9deHbNhmqq2Iy3wgIyH8Tq+26Lc6gwOy6+c4gzBI//UoL2FTYn67igW7/vjgE0=
  - secure: zgXJTBuK7P7fZzp4H7j4+7XyjX7kBOmaEy6D/TYPiR6TUTpJOBwt5eplFWCZWoyEDh1fponqqDClb9i/vtCtrRj9WF6COlif9ZcEwiY61zLJns2HMsykAL+vzHrnDpvI14iUSRnz237YLCO0oIZ5qY2ID7cMZDZY2E56oPHuqQlJUkfIBfH0lRXfvS+DeaAPB3ed44akYkLeZK6XHsAKwuEfMMIi5bLT/u/4sW+r7C4tWQl6kJ9L+L6So4t6R4FYriU8g3X4UdgV6uADxotpGcnon5zZ+Ty7lMhxK+eA7idwrZiunxRkEKKd+wOiVlXJKTRUvbEiiKBvqGHMoHTnxi9sJtzln6Ci8lxTrBNT66IjiuqqvbDEXKs5+EBUdf7vFW333PLVEw+r7Qr/eaKMcCta2HOHS/97uvob418GLygJY9PyFqr+vFdzCLmJmne/M1Plzz5nT/8uN96EGHdyeIO5+/eV8tuX99SGAJFE1ReAqKAXPrgDmhrcI9lCHO4WWuJq3El+/shRf/tcNgtwPZ3cSggaADSMRVHUsR5i9wY2cXRsOZI49ATFUYyE0Av95+IQ2G611RZvhErP7ThNGHAasH1VyhM9p3z7PtjwOQO/GFUWHJXTja0NeiOsKon0d+6+RpDKHfrh1jv6I65mzOAYMWOvqg0/5dzm5NrXGSY=
  - secure: TcfHY7bjN0FpAjaKpVWsuGJhD79PxvhGK8srJGiCAP8324Eeb5OPyExMTu670FQXDADoF9D7VcII3+yGzbl+5spDox5s+E3Rlf+ZNHYdPHVIvH4cV21JVC+xsXhECWWXCs1Cwkovoy+u0TkAj9A/z7Ju4mR54ng1GhVukJg3QqqAsqt4DIlUBGH9FlWNUTe9jUBYArL2/ma5Na5bZRnWfWm158Kf+RuyjiftvRcMnqIzjJ0J1sYqcyNTrniEFTu7QwWPUjPHCApJ0P9wF5qdRmL/dx5OEyOiJ54sixRJMUVz63JX9zjd03JyIF0xPmxRZmDFbyhcSPoZr2kluHq++Sx8KV1z6ti+lnTE9fLIt/JX1b/LmOLHOHKKuxY2rLGfR87CgfpNwgs23aHha1n7BsbhC3jLpiJcPY3RA1ZR8RfY42Cet4KZS9xy82WLhGqFZ4h728kQN0GLBF2rVVOOVPqm1e3FV3mzVz61hxtrMdkevPltBOjEnAeaZ1TvffY9freh9wFodSawTgJyQgGK3hmjUsingFY2aXcEkwLHiqgODqmD7JijNCg23WsZo7seEK2EYjnUZvIZfi2L9n5NaxL06yhIiOynXAJs7bJGDLK/FcbuPSlSX74HQ1kvcKvez8yoIH2cNCSepLMG52VRArFnj6Sc4ThP+utmjKnfDWk=
  - secure: ShnsmGF5/9uzJ+R6jWxe3/3qd8LgIiDlmG1a204fnS4mie1btSkPoIFtqlawW+w4pWJUqj09iBK+fgwe+QS17jvEyIhhNMPIo/FcYTARisVapZxAOEWmUg859NDkWyFpoOSO01j+3pztOQTEn4+8UhwbeauOgBSD8IP3JpPdcxfVeiMMzEjJQrZFivdGd7rD1vwf5fsXfrNiXoyYPDc/+Ol5PznWUSL/uEQNE+fGglFtD0gt0f9yh5jGOcdA2xJwwmfvw8zA0Xif1BJhyC0hhwTePvFPmZSQzS9P3rxIWpIV88PwjTuxN+/Rnr67ENGjDkmM0z0w4Bg8pbg2CebRKaLbZs8lbS/alzI+7n4nHOc9wouh1/6A0VgyRkSZC/0BIurB6WUaU4/72Vb+P/GzLIWcTYkAKQ8ctBcZIdNYqEdWJa5q+iWlL7U9hq3ir9PsVJtytWpBfzfavPwLSyIY7KijqYztTrE+QlNJio2bAVPo0OhpnFXj8Ao29QY1sqJS9iRxj7/wjlpf+50GLWAICJTwHRJhMVmoUVhs6LCb3EzJkE+IjRxHXSgIQe0Y6oXCvpH7vALRmxPL+riERCWYBcDAQVQjuCXed/Z92AVotfn4SbzqWZLnbPqtw3a51Nbdjkqp/PO/rLvx3JQlTv4aAlczUkA3R/qwKGfWqFBMA4o=
  - secure: sSIzCYl+BQng1BuL85PBm7g8KnAh53A6ZH4nqzHRoIdOgxwuDU8ekNhAvc6KCsGYxIv8uBk+77n2nSdMx5iw6Oo6KMDZL19u8KMKT8lqrbbzfMY3LMXd6aEsow1PEcJO1f8Hb2zemitYcujjSZmcJ+XQtHNiXpFBfu5ZLQLH0E1QVteL/WJHaiWf1prejObVCtXnYHzrQ5oO8Gy2Wn8ya3Pa/6c8qTTP7ZYN9bxgOjcWBun9yyOOhc+CxzUrkRcta1aKxGvZLs8lbFehrAezcj3Jg4iguo6NIY8M0MAkmrdhJY11YZl7YqH5uB/7feiXCbOo51MmBvZ5I8dpVv0gcnQiGrX19Szm+lUyTyD1IHfEjrGgbtePiytYprtLbMFP+MuNEfcP90zGr4B5vBDBdc2IHpyBopIqIwAyqkCXAIOLtsKso6o6dEUwuGrjFqJ9/Z2JJWNSt5GEWIirIPJrEImy7N4qwUkXS9nOKSIoWhaMeLJEQIdt9H4JEDmRZT76p1EfR4V2Qwhvy1/MEwdMW1sO/LQmjguMM89NokDtllTpJcwJz+1FPIi0yNwcBSasGmGrgsdhPJfAVltsVHOvJJ8lQ1RWHnCk9Y6vaP3ZEe/cBdYVfHBZtWAXn8chXzL7M+3KNwjeFvTHNl7jqxik9eBDUzos2XNMFyzCK6MmqnY=
  - secure: TTwth2PVH1vlPemBAnXTZs8je89wWCGxOp6iwq+gdukBKFe8HKv3TqfDJox7ij7SZ4nNsAGw1Jmkronght9qEWpvkcDhth3sVjt8zhTYxlnzN8ZC4I5PMItrP1wL87EWicIoOxXuPPh8wsM8rc+bD3i9Woh0jUtH4m6zF1PjI45uLYq3Lwd9qrEkTRPleuk4tyruyNre3OIvHnnrC6uNAmqbzfm2WqxdhpqH+7TjDlRcaVY3eR0kVKswPCH6bWhHSvHLSDnz81xCUTnUkyXrpk2v0PMCkOIw88lHdyBNgrjt373lLZa3QB4HGMYQL8/7EofLZEQRKOy3WWBCkgnccAguXfzNFlijDY1gtdGSHJWzw4nXVAKgUNRfyLkkiQ8RE0E/dg4mKu6Boa5BnpCVrxh30RRaU1Cx10w7s47v62Mwa6V1LzBnadiPgd9l4Q+m3G9xBsTuxCeiNzr3Z08UQr3q7Rusq8Yh4CmOBVchYsnVh/aGc5dLDQnPW7R29/SrGnzqZa299ngDni8DNY7r7qd9khitb6nZG0Ylvdc4KRZvLOWDWrEH+YncHeFjTnVWjuAreG8yYEKLUULXhXu94t7dT1yCen7ui97wlyM9DzdAnJcgGbq0fMgnu6Wn2laXYwO8Ax9y8zQrV7cel0OHglrdZFAO3AfoA1J0u9SxWkM=
  - secure: JjU4pZ7mdsZevCVvY9beN6L+zVRnzvlrUb/Blh4r2pNqlkkZkKN0nrOP/wSn6BWntT8a5mstO+NqA94gLbC/n+yFfHGBtoEFyH/QA2r+eU2hfD/7nr9+RJpWYumYI4+pc9/thFC9X9/efWp5lM/99A6/Z85eEb+5C20/QRBdLai+aGaYKrtigu6EHGmAdGtIhSYMlD2ViIdKwj0lgV1JlKFmQ+agY2lB+wv7PKhTUPfYoK86mOHXgp+1vPEzzbf+Qg/4+nhLByKbEX7p50j+5RAb2IRYvIJi1Vs+xGULkbIIUxX5pmxyTBNDghlz5nHr84ecsLjIYBEbuyTI14oKmSGHbIPDVFGGNZ3VMsnxRV03599N+i6JDTKb6BEP1QAGF36QTi3cBOmavTD1yfcVxqyn9k9oFjbuCPoIcsc5suPElUAnX7WywPHoKhMkmRTgeuwmwjUHFN9HDx3NFnDCg6NW+gWIMdB0L0zM3j/pZ/RhUKxZlgJfhg4G8/xFW+4HGURuxaARfcCk2d2EJ4zzB5ezzxowb/QXMLrfDYLCfwTdDNOBVgq7HUsOcNXL3sWSvrXna0m/Inyd+HyO/4L8ANR88T+uwjfM4CsZd0UNGSIvomDzaXFvt9x+iWj1H7jZNygwQtubY26lnQ1/x/yxdB18fkhsqpHMpE5SPNa26/w=
  - secure: JW7rDMxlwh6vzXujLm8JdHPCeAV7LM1wUFj7Ym6g6dfx3NmjCN6NtYzTuR09+a42z4VYl5NSHEFX2QFvSP8iVooPaFmA8pLE/clFcaSIxwtF025N03gb4EjZQV+MnoxjviI+XVQ6ggpMz2PrTcwNY7prNYkFcBTlrJNxbZEoCjpxZTkM4JcL3dARRx9O7iSkrbPLTI20ri4xXvn1HEBbx36IZjojsRmI39vPpRYe8SXToPiB/FfzZdQGlpU6vflz1ScDLZwmGPKsfF2e8teTnj0igudFxygu3B0Y+35pU/DvgSowAnf14Hd64MrPpMiT6OQfB8DIO43q4m7kTrukwblk03GGY0XCEcPDXPntXk681yP9lwXStG/uxo/pDZVtHn8DeMJSHp2IJymRhVFM8YwnJ3FkCyKoN03AFpDj3YPwhTfRQelIlnwzlGfuhVpXp1L7aTyG42oINd4owSh/uaN1vNhNskRRpqrH7gFhtXWwyEu152faBXWr9w9tKxjvQSiXU4RMwE7oIajUI1L340jReIs86MDBvrWoi0sdow1I4Sa8Y5W49NEjc3iKkWbAq9gbZcUbULNFJiVJ4VUZgw9gwpjEYZwfEOSK9ObX4z+Kz5WoUns2lyVEg2U39CypEyLoSw+gidY/SiP4RW1b2jzxatT3CpEgOCDO1vnmyuI=
  - secure: Gxzidpmr+T2k8NUuuqbkaD0caSqx0HL/vfw04fufUAuCbU7zz05wjrzVbrDCCY6l5dMGqXnY40/HuUBJIwQgN42p4BLfJeCVzhFwi12q9WS4L8SJdikOSH9mkFNnWUCP3hbbLBhkTH//OeI8eg+2lu/7sAU3bHxCsKgK9kgK0v4gL7sx+yT3SoLLTxC/j0ye3DVSwyDxcuRdip1Va/yADIrgByGKOlwd9HBEffbofMPqlIijdIxrmHR3l1emoOfGSUf1gCzcV5YveT8MEhsSzWd3z2C8Nz8MGfPMZlBFn9OC3ZUX3agCjv/h7goq8WsgmOC8MsZCow2t+amj0OFr92M3rSnF4lus8Wl63ckh37uW4SWv1U1kDBSLztY0SaH7QhLDmfkb8xITsRtHUCSLgYWs5mBafrA5ZF1q3NK0FhzC2q2oEiPJfThdLL2g9Km8WsZKL1+dHJYwGix2nqNXKLCnZA3eGVBmmKjEkqEAKXXpMJpDFcaSu52czVvtNwJRM9tLBhdsSSYz7jczCrfdvIpzONzlSPU2gmiGZHE1Cy1rlA0mUj77R9Ueq6Q8GjTsd9ADa5l5Bf+8sAciaB+fOFQ4cGEKQuRmbUbqECtFihdthCTgBJkCKmWOOUaISXU3BNVdDtNmIvKr3ZG+O1SiWUqUkKGFSbTAFOe7S/NjJP8=
  - secure: VtCBpnjfoN9CcSxLNl8tj2nxUOOdLk9quxZQj+Sgqql73cuVtaD024esQXQZfwTW3xUx7rCtltefAt7Fqpj8hwAjWrcO/VdF43EG/M1lnWVmmfSyofvcOMZZGe8bk0xjvyzXB4GzHguEjX1Oa78Qisb4qrzyDWXY+SqZTsmCq6DUKP/R/kLglrtO/lwSwuLr0nWS1TXdsoCX5z1Ck9rvklLWm0xMzlrcvrioFc6d0x6L6cYBhzbmx4FT5JMk/Dy+6i/VxAYOivP3SBoFnRVz5W4kvRPMnf0T/jewXcdKoFRanyI6EYBL59CXMc8yKgjg/lJiWFwcSvKmRSFNFAla28TlnpZRtgX41UIzQYUdWzFhJ8ONEDvKnegvlYP1cE/f3N52h7cjViCY0h2qSpW2dogm44iGGTg/1GwpYtsxbIgM7fbCSUkNLXACdNdyMa+akNszbpHOLlnMMjZYe3mchqLeGsMXMzrmA8i+nGNkX9dwaizN8+Wf0IQ8P8X2Pr7U7AP422AtNg/Ds/4BSXRxt08FPE4p+nTI9eo9veiiHuYLY+sJC8WeCXx2P8CHgiCitjWpAP9rhH1xxlxPzyMq80/3cDdEAcU2bUSi4SH41keRMq2i2ypuiv6M96VkSPpBwkxwzWoYUMJ5Qnk602C3ph8vkYd8o44Qq9ywjDhA81A=
  - secure: nhi+JAqZUzlB5J3vEIlRm8mi+3q4lbOuT1MjqnUizEp1RbxlKMgBrlodSjtyt1C185EEygkBYCCG+J3VW92h6yUvXPHWvXlkq20nr65+QIv09F30eBc3FMNHAjQ+Oa+tzkHviUgS/1BjXpq21ojUAx5EWiGxZusswyPrQlgH5DJv2VjKQ0xgDTM1pnhJm5USQZ6EzyADWO8uDvtntrrB6734FH1hlNK0eZdY5nXZFPs/IXjWclX0y5AJ1AhDoMtp7mYTlMo/p71aLmYNejVVQNKVUlaSmvgaUAdmEHwKKgYe5gmZPJHiggrdJ7XJijc2sOkQ7r3REtYToruFzzBuLAXgZ726MmM3NGQjWCjAhhylWVEI/gD7SBB3v64LkPJX+j4d6RWN+VE8PP4f0ojVOLCkOmfsFB+2YGqwIxDcUUOK0FsdgPtnsOszI6uRP+7XGYDV8YL+ngUjQ3mn198bZ4HTgwPOd0Z8vOgXsvGLnQiipMx7tA8QQYC/gf5X29rDQX2H1vZ084cWDZ6XXawQ64dgtGLS2V5p01nscI9mWp6x8ok1kRxTK+5aTClDtXdi3bB/XcKyx0OPZBDmNnocUEFSL6MXXUcZWvZydqR6OcFaKQRh8Y+DrDaME1Xu5C0OQ/Z8KroTQl6FX4D9Vy+FNer3wOvV+lt9qPW9YMzJfTo=
script:
- docker build --target test --tag todo-app:test .
- docker run todo-app:test tests
- docker run --env MONGO_USERNAME --env MONGO_PASSWORD --env MONGO_URL --env MONGO_DATABASE
  --env MONGO_PROTOCOL --env LOG_LEVEL todo-app:test tests_e2e
install:
- wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
- unzip terraform_"$TF_VERSION"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$TF_VERSION"_linux_amd64.zip
- terraform init
before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/todo-app:latest .
- docker push $DOCKER_USERNAME/todo-app:latest
- docker login --username=_ --password=$HEROKU_API_KEY registry.heroku.com
- docker tag $DOCKER_USERNAME/todo-app:latest registry.heroku.com/ganker-todo-app/web
- docker push registry.heroku.com/ganker-todo-app/web
- terraform apply -var prefix=ganker-todo -var OAUTH_CLIENT_ID=$OAUTH_CLIENT_ID -var
  OAUTH_CLIENT_SECRET=$OAUTH_CLIENT_SECRET -auto-approve
- export WEBHOOK_URL="$(terraform output -raw cd_webhook)"
deploy:
  provider: script
  script: bash ./webhook.sh
  on:
    branch: "$TRAVIS_BRANCH"
