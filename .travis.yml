services:
- docker
env:
  global:
  - secure: wIoZgAuj3XDeUYm2NLFJpSFwJmSCX++AxQLdqzEv1Psij8g1da1KJYn9Jq1MYa6OOdGnHCLlc2+/SvVcH9/gHayUQJZPzECkoiu1+H/dxY1od2wnWaeKqzLSZAggP49DWTPy+uMH5+5geID1H67tSMuRPkpxy80OYkdiDSyv2LIlrAJTXiRw0iwC7sx67gUoZofIFf6cZ6S4x7HJbSDWN/dZKWTBM4acXqp1XeU0VeyC5otXGtchPk+UhW59chspTOez2t3uUK7UZWxou/83rMsayZ23yZAcQ6+dyCOrxVQwcY2jwx4swzUbqkRJ13kZlGqt9ibSSx0tgTtaCOMkqAGxM+snq83FTCY6GQNkUJrSp643k2sl/x2fU3UmnoNovcvQLV5Xob+B15QS0wThPln8Cxz6M0iiRm2bb+rjd4Bv79oumZDlzoaG7kK3e30DxwKVU1ikOOtJsxPE2aM7NDGG+XoEPvQFEVBrq6bB3q3MLs4Bhoq/uKUGlyhJzJgzep13qM9/UTKcGdmXmKnbRjp+LpUbliz0GCoRKXfx6jpuPiZEYuExY6RIzuHOSpHsROUTNLhoCkJANPs3xNU8mKO3Yf3a5LnWtvOANXBOtc6bMqdfo08bizwNVn13fphNhyCxgw7jtqySkWUuw84xPEf6QVieCm+BeZS98UxoshM=
  - secure: SMxllV1JwXt+EKnXaxh3/oV845CZIrS3j28VSV/t7EZOIueAN6j9ICEuyTBTWqlkVAd5FueTYyL7kS+NgxDHraYvYDq+rxQE0wuc+zwd3NU0fszC0uD61SiXltYoGzNsmK++oqDKsXddYaqFyJ3osZQ/R1bxdzph4hn7AKonO7DGxXykl/xJf8XJ+KmwuFdRzFckkqdZxLUAfV3hm3uhJG+X/A4XMECkA7UpwFEUvspF/AsxXbozR0iZwApBXzKmChZwNU/HBoWxy3Cw/MrLfVwk83lnMhFpDjh4874IpFt6E/6NWil9l5cxJuea454OMQ/HuPbxr/ykTBsol+MelXuuYMjWOpV1H6ce1bScF+wh5atVmA08ZDfnpDeFzd+wXQTtKsLU+Y48nTxsfAtOKUifOjvqRmVZaLVXUO1MDHM9KDC2lOSG3Pj/cnh78c5lCcx78rNJTdyzyZ6gbGQ7AlQIIWhYj7svtEo7/BwQmEwTBC68xsG0FmBzO8igp6cgPlViouw5BPXxpaEcIHaQu5YrD9gBb4CXZs50RWYkwtK53HcoOEZHR+4/dY07QHkpDcr0fXL3h8OvF77KmgHdsJS10Sp4ccfrD22vnJRyyWjDzmjphkOfbQg6iro2Zp08YUQWokzw2esak4iFSArNX8WvQVycCJwHyv3JtGPXqfU=
  - secure: f/5CuVYNzwHCGA8ZnYm2tHVMmxU1Cm3u0CaD1ukJwPi1T/btpZ+Pc2muYDIinZVDpdakeRe737TIjGuvQ90WE2zkGyB6jHTWe7G+9ckcBHcCEl9BK40ytHrJlNmAI6qi5ZNBIFPnnTYgnlg/PC6oublP4+K36xGsfSdXG4BMGn+fBse22xSeIKfXQExrZg/rNwJkwV6PuzQvCADrBfJ0tXgHXpu+N2qwCU7PP5VQvOWxlrqptBBXHqCjYriJz2OtacgmJidqTF0nTaBQteMZG/knaYzlN+b9VL+z1kwu9UzdOEuNHMWkuHHQtUzyoaovGNTkT+Cqv/vnGg2rjYqBoM14tpTPhd9WMM8Gy5hfgTt2evcc1CcPpqnm28gUvdKu+1GcibFhYGIeBzOCBCjt2FaW/5fEIYF8eFkZBYJeHiGKGISel7O5T1x5NmTWoixx7boXWdVG2r0AdfHcm2djmChn9NLyAeR5+2AJgaUizkW28j8PGzOtUIBfs+dl0OIwuY1qGBXkSoDIRi+aoe02NCPOnE59K7fR1ETpXvCw1Ff/AslT/hwRLqCF5ik4uvPdTWkpqvaac+Gay9KUorD/rmjUSJuyxxnJYY3pIxzyDLuz9rLMwHJwHT2fa45i5fLINzwutHRvobDqXpb5xRgceIW2Mxut0q9xGXpKO/9eCgc=
  - secure: fLDGY95ZxGHnV/zt1HuD8JEaD4CeCboGGUdgaZcM3WhxzKgFWsIBNnUQ4H9rjhTt967tSf9eKoQIUNjNQuZfMkr/CGzqQ+kDHlcnMaY5cq0L2aA8RQSAKgSzpHKGNHTnEpgDfTr6tgQQ0p+g52IlnjTlkjL+UFREqaggARoqeMRbklEE1+g4b2HJnP+n46wxEacO93E1Lc2poWzD7+6qA8Q32fFYWOsQ70AowliS7u693CrMkv5wdr2+4cntQs4pyfSbJ+kyYsv+5SOsyG2YQzNaiSuxIem1ADlzioFaHfKuNerfEeafZXU4WfOqhU4QLCZsO9shnXRA8hUh/l11OGZBzIY6V/zE8BhzO70Y+T+6EP8Td0E496tPZaa+UrtgFQrc5JwQB5CrOkVCekpdna5+g4sm1qBgd+FxjXSK1W2WrY1RUl8RiLOsXbu7FcnUzpzKbAzbX6XHekAKWGvKapFy0/P/OGFJawDw9mnW1OYnUUr26juwPBajNecGUidRYoV3I3X39pn5YfYi2eJr2Bl5utNV92qB2qdPylhheuyRIOJKnFcSY+HzMOf82h976thhiYH3MDkZurYyIwNlxQ9hOGac1xtmFp2HeMxaq5H4BtMQMutDS/89TyDVy8M9WmkOx18vMe8CqmjjU4zBIkr797e9KIQBkiFPXbsAU1o=
  - secure: PkJ4XWXR2fS4pRZZCjZZU01t+75yTo+vNtZ+LKWPIqbABjLAZylk6yoxLolrMPV0GDCcBnhk4fPQu2ae0ci78Qj2j/6hk9TirhneLtVG53TmxwzGR/Ef1iBkgwonQxslL0CazJU1gKzfFNyBcBXU/BdxYyAAME9N1NgkehhPKwW2iphGS64NNdpHR99TdC4b6qpo/RxhVFIZVv/ye2auhTgZOEnrJkfNUgguDBB0wndfiQBRWp1Vm9/ILUIJxXpa99svGPzbEIqzT8riaEigGBqgIjbCm0mRfJAvoSpua/uR/t/69k4N14N78KaMiKw+X6iFRKZCDGqOekhW7Ng7K/vwLXB5zSuZKYX2G3YMoEeaVdKlLjRs7pOVMkFiatAwM0DvmIOdw46SDS4/brrYNPdfHI0jTEJM4VMRorLOioNYbFAp5N0Ssd3K1EBKBEnSQoAZIWN5CPYzJZ2/vq3o0hcXFCDO0A1qkqDwtZK8xHJgeUVrGRVeSXldR+xCxqXeINRVYAiA7fWVBjOlPzADmDUdyyZWUo3PFJlruMdjbCZeE9Mr5prR8f7/d3iH7WYQAOmElgTJk/161DmMdjKSYycv0UFlSr/GLvFknlK4EYJXtmf79V5es4ygSrm/mBNk2NrL/J0LoPMROQI0K4yfTF3SQYGrDKgAWwAS5SYvQHY=
script:
- docker build --target test --tag todo-app:test .
- docker run --env SECRET_KEY --env SECRET_TOKEN --env BOARD_ID todo-app:test tests
- docker run --env SECRET_KEY --env SECRET_TOKEN --env BOARD_ID todo-app:test tests_e2e
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USERNAME --password-stdin
- docker build --target production --tag $DOCKER_USERNAME/todo-app:latest .
- docker push $DOCKER_USERNAME/todo-app:latest
